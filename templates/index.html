{% extends "base.html" %}


{% block title %}RaTilicus 7D2D Map{% end %}

{% block head %}
<meta http-equiv="Cache-control" content="no-cache">
<script src="/static/sdtd.js"></script>
<script src="/static/ws.js"></script>
{% end %}

{% block script %}
function start() {
    init_map();
    //get_entities();
    get_markers();
    init_ws();
}

function onkey(e, down) {
//    e.preventDefault();
    if (e.target.id == 'chat-input') {
        if (e.keyCode == 13 && down) {
            send();
        }
    } else {
        console.log('onKey', e, down);
    }
}

{% end %}

{% block body %}
<br>
<br>
{% if login_errors %}
<div class="alert alert-error" role="alert">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong>Error Logging in!</strong> Please, check your username and password and try again.  
  Password is provided in the welcome message upon logging in to the server.
</div>
{% end %}
<div>
    <span class="">
        <button onclick="redraw_map()">Refresh Map</button>
        <input type="checkbox" id="follow-player" onclick="player_click()"> 
        <label for="follow-player">Follow</label>
    </span>
    <span id="entity-info"></span>
</div>

<div>

    <div>
        <div id="map"></div>
        <div id="spot-info"></div>
    </div>
    <div>
        <div id="chat-output"></div>
        <input type="text" id="chat-input" onkeydown="onkey(event, true);" placeholder="Type here to send a message">
    </div>
</div>

<script type="text/template" class="entity_info_template">
Playing: <% for(eid in players) { var player = players[eid]; %><button onclick="player_click(<%= eid %>)"><%= player.name %></button><% } %>
</script>

<script type="text/template" class="spot_info_template">
<button onclick="create_marker(<%= lat %>, <%= lng %>)">Create a Marker</button>
{% if user %}
<button onclick="teleport(<%= lng %>, <%= lat %>)">Teleport</button>
{% end %}
<%= NSEW %> Coord: (<%= lng %>, ?, <%= lat %>) 
Region: (<%= Math.floor(lng/512) %>, <%= Math.floor(lat/512) %>)
Sector: (<%= Math.floor((lng<0 ? 32: 0)+lng%512/16) %>, <%= Math.floor((lat<0 ? 32: 0)+lat%512/16) %>)
</script>

{% end %}
